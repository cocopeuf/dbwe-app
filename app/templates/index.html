{% extends "base.html" %}
{% import "bootstrap_wtf.html" as wtf %}

{% block content %}
    <h1>{{ _('Hi, %(username)s!', username=current_user.username) }}</h1>
    
    {# Separate upcoming dinner events into created, invited, and accepted #}
    {% set created_events = [] %}
    {% set invited_events = [] %}
    {% set accepted_events = [] %}
    {% for event in upcoming_events %}
      {% if event.creator == current_user %}
         {% set _ = created_events.append(event) %}
      {% else %}
         {% set rsvp_list = event.rsvps | selectattr("user_id", "equalto", current_user.id) | list %}
         {% if rsvp_list and rsvp_list[0].status == 'accepted' %}
             {% set _ = accepted_events.append(event) %}
         {% else %}
             {% set _ = invited_events.append(event) %}
         {% endif %}
      {% endif %}
    {% endfor %}

    <div class="created-events mt-4">
      <h2>{{ _('Dinner Events You Created') }}</h2>
      <ul>
        {% for event in created_events %}
          <li>
            <a href="{{ url_for('main.dinner_event_detail', event_id=event.id) }}">
              {{ event.title }}
            </a> - {{ _('On') }} {{ event.event_date.strftime('%Y-%m-%d %H:%M') }}
          </li>
        {% else %}
          <li>{{ _('No created dinner events.') }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="invited-events mt-4">
      <h2>{{ _('Dinner Events You Are Invited To') }}</h2>
      <ul>
        {% for event in invited_events %}
          <li>
            <a href="{{ url_for('main.dinner_event_detail', event_id=event.id) }}">
              {{ event.title }}
            </a> - {{ _('Invited by') }} {{ event.creator.username }} - {{ _('On') }} {{ event.event_date.strftime('%Y-%m-%d %H:%M') }}
          </li>
        {% else %}
          <li>{{ _('No pending invitations.') }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="accepted-events mt-4">
      <h2>{{ _('Dinner Events You Accepted') }}</h2>
      <ul>
        {% for event in accepted_events %}
          <li>
            <a href="{{ url_for('main.dinner_event_detail', event_id=event.id) }}">
              {{ event.title }}
            </a> - {{ _('On') }} {{ event.event_date.strftime('%Y-%m-%d %H:%M') }}
          </li>
        {% else %}
          <li>{{ _('No accepted dinner events.') }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="text-center mt-4">
        <a href="{{ url_for('main.explore') }}" class="btn btn-primary btn-lg">{{ _('Explore all dinner events') }}</a>
    </div>
{% endblock %}
