{% extends "base.html" %}
{% block content %}
  <h1>{{ event.title }}</h1>
  <p>{{ event.description }}</p>
  <p><a href="{{ event.menu_url }}" target="_blank">{{ _('View Menu') }}</a></p>
  <p>{{ _('Created by') }}: {{ event.creator.username }}</p>
  {% if current_user == event.creator %}
    <a href="{{ url_for('main.edit_dinner_event', event_id=event.id) }}" class="btn btn-secondary">{{ _('Edit') }}</a>
  {% endif %}
  <h3>{{ _('Invited Users') }}</h3>
  <ul>
    {% for user in event.invited %}
      <li>{{ user.username }}</li>
    {% else %}
      <li>{{ _('No invitations yet.') }}</li>
    {% endfor %}
  </ul>

  {% if current_user == event.creator %}
    <h3>{{ _('Invite a User') }}</h3>
    <div class="mb-3">
      <input type="text" id="invite_username" class="form-control" placeholder="{{ _('Enter username') }}">
    </div>
    <button type="button" class="btn btn-primary" onclick="inviteUser('{{ event.id }}')">
      {{ _('Invite') }}
    </button>
    <script>
      function inviteUser(eventId) {
        var username = document.getElementById('invite_username').value.trim();
        if (!username) {
          alert('{{ _("Please enter a username.") }}');
          return;
        }
        fetch(`/dinner_event/${eventId}/invite/${username}`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json; charset=utf-8'}
        })
        .then(response => {
          if (response.redirected) {
            location.href = response.url;
          } else {
            return response.json();
          }
        })
        .then(data => {
          if (data && data.success) {
            alert('{{ _("User invited successfully!") }}');
            location.reload();
          } else {
            alert('{{ _("Failed to invite user.") }}');
          }
        })
        .catch(error => {
          console.error(error);
          alert('{{ _("Error inviting user.") }}');
        });
      }
    </script>
  {% endif %}
{% endblock %}